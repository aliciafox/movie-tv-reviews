<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies & TV Shows</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        input, select {
            padding: 8px;
            margin: 10px 0;
            width: 100%;
            max-width: 400px;
        }
        #results {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            list-style-type: none;
            padding: 0;
        }
        .result-item {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 10px;
            max-width: 200px;
        }
        .result-item img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
        .result-item h3 {
            margin: 0;
        }
        .result-item p {
            margin: 5px 0;
        }
        #pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .page-btn {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ddd;
            cursor: pointer;
        }
        .page-btn.active {
            background-color: #ddd;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Search for Movies</h1>
    <input type="text" id="searchInput" placeholder="Search by title..." onkeyup="fetchResults(1)">
    <select id="genreSelect" onchange="fetchResults(1)">
        <option value="">Select Genre</option>
    </select>
    <input type="number" id="yearInput" placeholder="Year (e.g., 2020)" onkeyup="fetchResults(1)">
    <input type="number" id="ratingInput" placeholder="Rating (e.g., 7)" min="1" max="10" onkeyup="fetchResults(1)">

    <ul id="results"></ul>
    <div id="pagination"></div>

    <script>
        const apiKey = '3f2fe61ae14a656e1ad11ff26b0d0594';
        const apiUrl = 'https://api.themoviedb.org/3/';
        let currentPage = 1;
        let totalPages = 1;

        const currentYear = new Date().getFullYear();
        const genreMap = new Map(); // Stores genre IDs and their names for easy access.

        async function fetchGenres() {
            const response = await fetch(`${apiUrl}genre/movie/list?api_key=${apiKey}&language=en-US`);
            const data = await response.json();
            const genreSelect = document.getElementById('genreSelect');
            genreSelect.innerHTML = '<option value="">Select Genre</option>';
            data.genres.forEach(genre => {
                genreMap.set(genre.id, genre.name); // Store genre ID and name in the map.
                const option = document.createElement('option');
                option.value = genre.id;
                option.textContent = genre.name;
                genreSelect.appendChild(option);
            });
        }

        async function fetchResults(page = 1) {
            currentPage = page;
            const searchQuery = document.getElementById('searchInput').value;
            const genre = document.getElementById('genreSelect').value;
            const year = document.getElementById('yearInput').value;
            const rating = document.getElementById('ratingInput').value;

            let url = `${apiUrl}discover/movie?api_key=${apiKey}&language=en-US&sort_by=release_date.desc&page=${page}&vote_count.gte=10&release_date.lte=${currentYear}-12-31`;

            if (searchQuery) url += `&query=${encodeURIComponent(searchQuery)}`;
            if (genre) url += `&with_genres=${genre}`;
            if (year) url += `&primary_release_year=${year}`;
            if (rating) url += `&vote_average.gte=${rating}`;

            const response = await fetch(url);
            const data = await response.json();
            totalPages = data.total_pages;

            displayResults(data.results);
            displayPagination();
        }

        function displayResults(results) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';

            if (!results.length) {
                resultsContainer.innerHTML = '<p>No results found.</p>';
                return;
            }

            results.forEach(item => {
                const genres = item.genre_ids.map(id => genreMap.get(id)).join(', ') || 'Unknown Genre';
                const roundedRating = Math.round(item.vote_average);
                const releaseYear = item.release_date ? item.release_date.split('-')[0] : 'Unknown';

                const listItem = document.createElement('li');
                listItem.classList.add('result-item');

                const posterUrl = item.poster_path ? `https://image.tmdb.org/t/p/w200${item.poster_path}` : 'https://via.placeholder.com/200x300';
                listItem.innerHTML = `
                    <img src="${posterUrl}" alt="${item.title}">
                    <h3>${item.title}</h3>
                    <p><strong>Year:</strong> ${releaseYear}</p>
                    <p><strong>Rating:</strong> ${roundedRating}/10</p>
                    <p><strong>Genre:</strong> ${genres}</p>
                    <button onclick="viewDetails(${item.id})">View Details</button>
                `;
                resultsContainer.appendChild(listItem);
            });
        }

        async function viewDetails(movieId) {
            const response = await fetch(`${apiUrl}movie/${movieId}?api_key=${apiKey}&append_to_response=videos`);
            const data = await response.json();

            const genres = data.genres.map(genre => genre.name).join(', ') || 'Unknown Genre';
            const trailer = data.videos.results.find(video => video.type === 'Trailer' && video.site === 'YouTube');
            const trailerLink = trailer ? `<a href="https://www.youtube.com/watch?v=${trailer.key}" target="_blank">Watch Trailer</a>` : 'Trailer not available';

            alert(`
                Title: ${data.title}
                Overview: ${data.overview || 'No overview available.'}
                Year: ${data.release_date ? data.release_date.split('-')[0] : 'Unknown'}
                Rating: ${Math.round(data.vote_average)}/10
                Genres: ${genres}
                ${trailerLink}
            `);
        }

        function displayPagination() {
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';

            if (currentPage > 1) {
                const prevButton = document.createElement('button');
                prevButton.classList.add('page-btn');
                prevButton.textContent = 'Previous';
                prevButton.onclick = () => fetchResults(currentPage - 1);
                paginationContainer.appendChild(prevButton);
            }

            if (currentPage < totalPages) {
                const nextButton = document.createElement('button');
                nextButton.classList.add('page-btn');
                nextButton.textContent = 'Next';
                nextButton.onclick = () => fetchResults(currentPage + 1);
                paginationContainer.appendChild(nextButton);
            }
        }

        async function init() {
            await fetchGenres();
            fetchResults();
        }

        init();
    </script>
</body>
</html>
