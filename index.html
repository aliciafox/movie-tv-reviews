<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        input, select {
            padding: 8px;
            margin: 10px 0;
            width: 100%;
            max-width: 400px;
        }
        #results {
            list-style-type: none;
            padding: 0;
        }
        .result-item {
            display: flex;
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 10px;
            background-color: #f9f9f9;
        }
        .result-item img {
            width: 100px;
            height: 150px;
            object-fit: cover;
            margin-right: 15px;
        }
        .result-item h3 {
            margin: 0;
        }
        .result-item p {
            margin: 5px 0;
        }
        #pagination {
            text-align: center;
            margin-top: 20px;
        }
        .page-btn {
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Search for Movies</h1>
    
    <!-- Search Filters -->
    <input type="text" id="searchInput" placeholder="Search by title..." onkeyup="fetchResults()">
    <select id="genreSelect" onchange="fetchResults()">
        <option value="">Select Genre</option>
        <!-- Genres will be populated by TMDb API -->
    </select>
    <input type="number" id="yearInput" placeholder="Year (e.g. 2020)" onkeyup="fetchResults()">
    <input type="number" id="ratingInput" placeholder="Rating (1-10)" step="1" min="1" max="10" onkeyup="fetchResults()">

    <h2>Movie Results</h2>
    <ul id="results"></ul>

    <!-- Pagination -->
    <div id="pagination"></div>

    <script>
        const apiKey = '3f2fe61ae14a656e1ad11ff26b0d0594';
        const apiUrl = 'https://api.themoviedb.org/3/';
        const genresEndpoint = 'genre/movie/list?api_key=' + apiKey + '&language=en-US';
        
        let currentPage = 1;
        let totalPages = 1;
        let genres = [];

        // Fetch genres for dropdown
        async function fetchGenres() {
            try {
                const response = await fetch(apiUrl + genresEndpoint);
                const data = await response.json();
                if (data.genres) {
                    genres = data.genres;
                    const genreSelect = document.getElementById('genreSelect');
                    genres.forEach(genre => {
                        const option = document.createElement('option');
                        option.value = genre.id;
                        option.textContent = genre.name;
                        genreSelect.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error fetching genres:', error);
            }
        }

        // Fetch results based on filters
        async function fetchResults(page = 1) {
            currentPage = page;
            const searchInput = document.getElementById('searchInput').value;
            const genreSelect = document.getElementById('genreSelect').value;
            const yearInput = document.getElementById('yearInput').value;
            const ratingInput = document.getElementById('ratingInput').value;

            let url = apiUrl + 'discover/movie?api_key=' + apiKey + '&language=en-US&page=' + currentPage + '&sort_by=release_date.desc';

            if (searchInput) url += '&query=' + searchInput;
            if (genreSelect) url += '&with_genres=' + genreSelect;
            if (yearInput) url += '&year=' + yearInput;
            if (ratingInput) url += '&vote_average.gte=' + ratingInput;

            try {
                const response = await fetch(url);
                const data = await response.json();
                totalPages = data.total_pages;
                displayResults(data.results);
                displayPagination();
            } catch (error) {
                console.error('Error fetching results:', error);
            }
        }

        // Display movie results
        function displayResults(movies) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';

            const currentYear = new Date().getFullYear();

            // Filter out movies released in the future
            const filteredMovies = movies.filter(movie => {
                const releaseYear = movie.release_date ? new Date(movie.release_date).getFullYear() : null;
                return releaseYear && releaseYear <= currentYear;
            });

            if (filteredMovies.length === 0) {
                resultsContainer.innerHTML = '<li>No results found</li>';
                return;
            }

            filteredMovies.forEach(movie => {
                const listItem = document.createElement('li');
                listItem.classList.add('result-item');

                const imageUrl = movie.poster_path ? 'https://image.tmdb.org/t/p/w200' + movie.poster_path : 'https://via.placeholder.com/100x150';
                const releaseYear = movie.release_date ? new Date(movie.release_date).getFullYear() : 'N/A';
                const rating = movie.vote_average ? Math.round(movie.vote_average) : 'N/A';

                // Get genre names for movie
                const genresForMovie = movie.genre_ids.map(genreId => {
                    const genre = genres.find(genre => genre.id === genreId);
                    return genre ? genre.name : 'Unknown';
                }).join(', ');

                listItem.innerHTML = `
                    <img src="${imageUrl}" alt="${movie.title}">
                    <div>
                        <h3>${movie.title}</h3>
                        <p><strong>Release Year:</strong> ${releaseYear}</p>
                        <p><strong>Rating:</strong> ${rating}</p>
                        <p><strong>Genres:</strong> ${genresForMovie}</p>
                        <button onclick="viewDetails(${movie.id})">View Details</button>
                    </div>
                `;
                resultsContainer.appendChild(listItem);
            });
        }

        // Display pagination
        function displayPagination() {
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';

            if (currentPage > 1) {
                const prevButton = document.createElement('button');
                prevButton.classList.add('page-btn');
                prevButton.textContent = 'Previous';
                prevButton.onclick = () => fetchResults(currentPage - 1);
                paginationContainer.appendChild(prevButton);
            }

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.classList.add('page-btn');
                pageButton.textContent = i;
                pageButton.onclick = () => fetchResults(i);
                if (i === currentPage) {
                    pageButton.style.fontWeight = 'bold';
                }
                paginationContainer.appendChild(pageButton);
            }

            if (currentPage < totalPages) {
                const nextButton = document.createElement('button');
                nextButton.classList.add('page-btn');
                nextButton.textContent = 'Next';
                nextButton.onclick = () => fetchResults(currentPage + 1);
                paginationContainer.appendChild(nextButton);
            }
        }

        // Show details of selected movie
        async function viewDetails(movieId) {
            const url = `https://api.themoviedb.org/3/movie/${movieId}?api_key=${apiKey}&language=en-US`;
            try {
                const response = await fetch(url);
                const movieDetails = await response.json();

                const trailerResponse = await fetch(`https://api.themoviedb.org/3/movie/${movieId}/videos?api_key=${apiKey}&language=en-US`);
                const trailerData = await trailerResponse.json();
                const trailerKey = trailerData.results.length > 0 ? trailerData.results[0].key : null;

                let movieInfo = `
                    <h2>${movieDetails.title}</h2>
                    <p><strong>Overview:</strong> ${movieDetails.overview}</p>
                    <p><strong>Release Date:</strong> ${movieDetails.release_date}</p>
                    <p><strong>Genres:</strong> ${movieDetails.genres.map(genre => genre.name).join(', ')}</p>
                    <p><strong>Rating:</strong> ${Math.round(movieDetails.vote_average)}</p>
                `;

                if (trailerKey) {
                    movieInfo += `<p><strong>Trailer:</strong> <a href="https://www.youtube.com/watch?v=${trailerKey}" target="_blank">Watch Trailer</a></p>`;
                }

                const similarMoviesResponse = await fetch(`https://api.themoviedb.org/3/movie/${movieId}/similar?api_key=${apiKey}&language=en-US&page=1`);
                const similarMoviesData = await similarMoviesResponse.json();

                movieInfo += '<h3>Similar Movies</h3><ul>';
                similarMoviesData.results.forEach(similarMovie => {
                    movieInfo += `<li>${similarMovie.title}</li>`;
                });
                movieInfo += '</ul>';

                document.body.innerHTML = movieInfo;
            } catch (error) {
                console.error('Error fetching movie details:', error);
            }
        }

        // Initialize the app
        fetchGenres();
        fetchResults();
    </script>
</body>
</html>
