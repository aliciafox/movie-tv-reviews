<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie & Show Search with Pagination</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        input, select {
            padding: 8px;
            margin: 10px 0;
            width: 100%;
            max-width: 400px;
        }
        #results {
            list-style-type: none;
            padding: 0;
        }
        .result-item {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 10px;
        }
        .result-item img {
            width: 100px;
            height: 150px;
            object-fit: cover;
            margin-right: 15px;
        }
        .result-item h3 {
            margin: 0;
        }
        .result-item p {
            margin: 5px 0;
        }
        #pagination {
            text-align: center;
            margin-top: 20px;
        }
        .page-btn {
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Search for Movies or Shows</h1>

    <input type="text" id="searchInput" placeholder="Search by title..." onkeyup="fetchResults()">
    <select id="genreSelect" onchange="fetchResults()">
        <option value="">Select Genre</option>
        <!-- Genres will be populated by TMDb API -->
    </select>
    <input type="number" id="yearInput" placeholder="Year (e.g. 2020)" onkeyup="fetchResults()">
    <input type="number" id="ratingInput" placeholder="Rating (e.g. 7.5)" step="0.1" onkeyup="fetchResults()">

    <h2>Top 100 Movies & Shows</h2>
    <ul id="results"></ul>

    <div id="pagination"></div>

    <script>
        const apiKey = '3f2fe61ae14a656e1ad11ff26b0d0594'; 
        const apiUrl = 'https://api.themoviedb.org/3/';
        const genresEndpoint = 'genre/movie/list?api_key=' + apiKey + '&language=en-US';
        
        let currentPage = 1; // Initial page
        let totalPages = 1; // To keep track of total pages
        
        // Fetch genres from TMDb API to populate the genre dropdown
        async function fetchGenres() {
            const response = await fetch(apiUrl + genresEndpoint);
            const data = await response.json();
            const genreSelect = document.getElementById('genreSelect');
            
            if (!genreSelect) {
                console.error('Genre select element not found!');
                return;
            }

            data.genres.forEach(genre => {
                const option = document.createElement('option');
                option.value = genre.id;
                option.textContent = genre.name;
                genreSelect.appendChild(option);
            });
        }

        // Function to fetch movie/show results based on user input
        async function fetchResults(page = 1) {
            currentPage = page;
            const searchQuery = document.getElementById('searchInput') ? document.getElementById('searchInput').value : '';
            const genre = document.getElementById('genreSelect') ? document.getElementById('genreSelect').value : '';
            const year = document.getElementById('yearInput') ? document.getElementById('yearInput').value : '';
            const rating = document.getElementById('ratingInput') ? document.getElementById('ratingInput').value : '';

            let url = apiUrl + 'search/movie?api_key=' + apiKey + '&query=' + searchQuery + '&language=en-US&page=' + currentPage + '&include_adult=false';

            if (genre) url += '&with_genres=' + genre;
            if (year) url += '&year=' + year;
            if (rating) url += '&vote_average.gte=' + rating; // Filters for ratings greater than or equal to the provided value

            const response = await fetch(url);
            const data = await response.json();

            totalPages = data.total_pages; // Get the total number of pages
            displayResults(data.results);
            displayPagination();
        }

        // Function to display search results on the page
        function displayResults(results) {
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';

            if (results.length === 0) {
                resultsContainer.innerHTML = '<li>No results found</li>';
                return;
            }

            results.forEach(item => {
                const listItem = document.createElement('li');
                listItem.classList.add('result-item');
                
                const imageUrl = item.poster_path ? 'https://image.tmdb.org/t/p/w200' + item.poster_path : 'https://via.placeholder.com/100x150';
                
                // Get genre names for each movie/show
                const genres = item.genre_ids.map(genreId => {
                    const genre = data.genres.find(genre => genre.id === genreId);
                    return genre ? genre.name : 'Unknown';
                }).join(', ');

                listItem.innerHTML = `
                    <img src="${imageUrl}" alt="${item.title}">
                    <div>
                        <h3>${item.title}</h3>
                        <p><strong>Release Date:</strong> ${item.release_date || 'N/A'}</p>
                        <p><strong>Genres:</strong> ${genres}</p>
                        <p><strong>Rating:</strong> ${item.vote_average || 'N/A'}</p>
                        <p><strong>Overview:</strong> ${item.overview || 'No description available.'}</p>
                    </div>
                `;
                resultsContainer.appendChild(listItem);
            });
        }

        // Function to display pagination buttons
        function displayPagination() {
            const paginationContainer = document.getElementById('pagination');
            paginationContainer.innerHTML = '';

            // Create "Previous" button
            if (currentPage > 1) {
                const prevButton = document.createElement('button');
                prevButton.classList.add('page-btn');
                prevButton.textContent = 'Previous';
                prevButton.onclick = () => fetchResults(currentPage - 1);
                paginationContainer.appendChild(prevButton);
            }

            // Create page number buttons
            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.classList.add('page-btn');
                pageButton.textContent = i;
                pageButton.onclick = () => fetchResults(i);
                if (i === currentPage) {
                    pageButton.style.fontWeight = 'bold';
                }
                paginationContainer.appendChild(pageButton);
            }

            // Create "Next" button
            if (currentPage < totalPages) {
                const nextButton = document.createElement('button');
                nextButton.classList.add('page-btn');
                nextButton.textContent = 'Next';
                nextButton.onclick = () => fetchResults(currentPage + 1);
                paginationContainer.appendChild(nextButton);
            }
        }

        // Initialize the page by fetching top-rated movies and genres when it loads
        document.addEventListener("DOMContentLoaded", function () {
            fetchGenres();
            fetchResults(); // Start with initial results
        });
    </script>
</body>
</html>
